"use strict";(()=>{var e={};e.id=112,e.ids=[112],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1421:e=>{e.exports=require("node:child_process")},1455:e=>{e.exports=require("node:fs/promises")},1708:e=>{e.exports=require("node:process")},3024:e=>{e.exports=require("node:fs")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4990:(e,r,t)=>{t.r(r),t.d(r,{createBook:()=>s,deleteBook:()=>d,getAllBooks:()=>i,getBookById:()=>a,updateBook:()=>n});var o=t(1937);let s=async e=>{let{title:r,author:t,publisher:s,isbn:a,published_year:i,stock:n}=e;console.log({data:e});try{if(!r)throw Error("Missing required field: title");if(!t)throw Error("Missing required field: author");if(!n)throw Error("Missing required field: stock");return await o.A.book.create({data:{title:r,author:t,publisher:s||void 0,isbn:a||void 0,published_year:i||void 0,stock:n}})}catch(e){throw Error("Error creating book")}},a=async e=>{try{let r=await o.A.book.findUnique({where:{id:e}});if(!r)throw Error("Book not found");return r}catch(e){throw Error(e.message)}},i=async()=>{try{return await o.A.book.findMany()}catch(e){throw Error("Error fetching books")}},n=async(e,r="PUT")=>{try{console.log({data:e});let{id:t,...s}=e;if(!t)throw Error("Book ID is required.");let a={};if("PUT"===r){for(let e of["title","author","publisher","isbn","published_year","stock"])if(!(e in s))throw Error(`Missing required field for PUT: ${e}`);a=s}else if("PATCH"===r){if(0===Object.keys(s).length)throw Error("No fields provided for PATCH.");a=s}else throw Error(`Unsupported method: ${r}`);return await o.A.book.update({where:{id:t},data:a})}catch(r){if("P2025"===r.code)throw Error(`Book with id ${e.id} not found.`);throw r}},d=async e=>{try{return await o.A.book.delete({where:{id:e}})}catch(e){throw Error("Book not found")}}},5511:e=>{e.exports=require("crypto")},6698:e=>{e.exports=require("node:async_hooks")},6760:e=>{e.exports=require("node:path")},7066:e=>{e.exports=require("node:tty")},7598:e=>{e.exports=require("node:crypto")},7869:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>y,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>k});var o={};t.r(o),t.d(o,{DELETE:()=>h,GET:()=>c,PATCH:()=>f,PUT:()=>w});var s=t(6559),a=t(8088),i=t(7719);let{NextResponse:n}=t(2190),{getBookById:d,deleteBook:p,updateBook:u}=t(4990),{validateToken:l}=t(8682),c=async(e,{params:r})=>{try{let t=e.headers.get("Authorization");await l(t.split(" ")[1]);let{id:o}=await r;if(!(o=parseInt(o)))throw Error("Invalid id");let s=await d(o);return n.json({message:"get book by id",data:s},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return n.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},h=async(e,{params:r})=>{try{let t=e.headers.get("Authorization");await l(t.split(" ")[1]);let{id:o}=await r;if(!(o=parseInt(o)))throw Error("Invalid id");let s=await p(o);return n.json({message:"delete books successfully",result:s},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return n.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},w=async(e,{params:r})=>{try{let t=e.headers.get("Authorization");await l(t.split(" ")[1]);let{id:o}=await r,s=await e.json();if(!(o=parseInt(o)))throw Error("Invalid id");s.id=o;let a=await u(s,"PUT");return n.json({message:"update books successfully",result:a},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return n.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},f=async(e,{params:r})=>{try{let t=e.headers.get("Authorization");await l(t.split(" ")[1]);let{id:o}=await r,s=await e.json();if(!(o=parseInt(o)))throw Error("Invalid id");s.id=o,console.log("dataJson",s);let a=await u(s,"PATCH");return n.json({message:"update books successfully",result:a},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return n.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},y=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/v1/books/[id]/route",pathname:"/api/v1/books/[id]",filename:"route",bundlePath:"app/api/v1/books/[id]/route"},resolvedPagePath:"/home/zaens/Codes/rest-api-with-nextjs/app/api/v1/books/[id]/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:g,workUnitAsyncStorage:k,serverHooks:x}=y;function q(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:k})}},7910:e=>{e.exports=require("stream")},7975:e=>{e.exports=require("node:util")},8161:e=>{e.exports=require("node:os")},8354:e=>{e.exports=require("util")},8474:e=>{e.exports=require("node:events")},8682:(e,r,t)=>{t.r(r),t.d(r,{validateToken:()=>a});var o=t(5586),s=t.n(o);let a=e=>{try{if(!e)throw Error("Token is required");let r=s().verify(e,process.env.JWT_SECRET,(e,r)=>{if(e)throw Error(e.message);return r});if(r.exp<Math.floor(Date.now()/1e3))throw Error("Token expired");return r}catch(e){throw Error(e.message)}}},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[922,205,629],()=>t(7869));module.exports=o})();