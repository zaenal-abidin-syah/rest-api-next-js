"use strict";(()=>{var e={};e.id=881,e.ids=[881],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1421:e=>{e.exports=require("node:child_process")},1455:e=>{e.exports=require("node:fs/promises")},1708:e=>{e.exports=require("node:process")},3024:e=>{e.exports=require("node:fs")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5446:(e,r,t)=>{t.r(r),t.d(r,{createLoan:()=>a,deleteLoans:()=>u,getAllLoans:()=>n,getLoanById:()=>s,updateLoans:()=>i});var o=t(1937);let a=async e=>{let{book_id:r,user_id:t}=e;try{if(!t)throw Error("Missing required field: user_id");if(!r)throw Error("Missing required field: book_id)");let e=Math.floor(Date.now()/1e3)+259200,a=new Date(1e3*e);return await o.A.loan.create({data:{book_id:r,user_id:t,due_date:a}})}catch(e){throw Error("Error creating loan")}},s=async e=>{try{let r=await o.A.loan.findUnique({where:{id:e}});if(!r)throw Error("Loan not found");return r}catch(e){throw Error(e.message)}},n=async()=>{try{return await o.A.loan.findMany()}catch(e){throw Error("Error fetching loans")}},i=async e=>{try{let{id:r,...t}=e;if(!r)throw Error("Loan ID is required.");let a=new Date,s={};if(0===Object.keys(t).length)throw Error("No fields provided for PATCH.");return(s=t).return_date=a,s.status="returned",console.log({updates:s}),await o.A.loan.update({where:{id:r},data:s})}catch(r){if("P2025"===r.code)throw Error(`Loans with id ${e.id} not found.`);throw r}},u=async e=>{try{return await o.A.loan.delete({where:{id:e}})}catch(e){throw Error("Loan not found")}}},5511:e=>{e.exports=require("crypto")},6275:(e,r,t)=>{t.r(r),t.d(r,{createUser:()=>s,getUserByEmail:()=>i,getUserById:()=>n,getUserByUsername:()=>u});var o=t(1937),a=t(5663);let s=async e=>{try{let{email:r,password:t,username:s,fullname:n}=e;if(await o.A.user.findUnique({where:{username:s}}))throw Error("User already exists");if(await o.A.user.findUnique({where:{email:r}}))throw Error("Email already exists");let i=await (0,a.tW)(t,10);return await o.A.user.create({data:{email:r,password:i,username:s,fullname:n??void 0}})}catch(e){throw console.error("Error creating user:",e),Error(e.message)}},n=async e=>{try{let r=await o.A.user.findUnique({where:{id:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}},i=async e=>{try{let r=await o.A.user.findUnique({where:{email:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}},u=async e=>{try{let r=await o.A.user.findUnique({where:{username:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}}},6698:e=>{e.exports=require("node:async_hooks")},6760:e=>{e.exports=require("node:path")},7066:e=>{e.exports=require("node:tty")},7187:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>w,serverHooks:()=>x,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{GET:()=>c,POST:()=>h});var a=t(6559),s=t(8088),n=t(7719);let{NextResponse:i}=t(2190),{getAllLoans:u,createLoan:d}=t(5446),{validateToken:p}=t(8682),{getUserByEmail:l}=t(6275),c=async e=>{try{let r=e.headers.get("Authorization");await p(r.split(" ")[1]);let t=await u();return i.json({message:"successfully get all loans",data:t},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return i.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},h=async e=>{try{let r=e.headers.get("Authorization"),t=await p(r.split(" ")[1]),o=await e.json();return o.user_id=(await l(t.email)).id,console.log({dataJson:o}),await d(o),i.json({message:"create loans successfully"},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return i.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},w=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/v1/loans/route",pathname:"/api/v1/loans",filename:"route",bundlePath:"app/api/v1/loans/route"},resolvedPagePath:"/home/zaens/Codes/rest-api-with-nextjs/app/api/v1/loans/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:f,workUnitAsyncStorage:y,serverHooks:x}=w;function g(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:y})}},7598:e=>{e.exports=require("node:crypto")},7910:e=>{e.exports=require("stream")},7975:e=>{e.exports=require("node:util")},8161:e=>{e.exports=require("node:os")},8354:e=>{e.exports=require("util")},8474:e=>{e.exports=require("node:events")},8682:(e,r,t)=>{t.r(r),t.d(r,{validateToken:()=>s});var o=t(5586),a=t.n(o);let s=e=>{try{if(!e)throw Error("Token is required");let r=a().verify(e,process.env.JWT_SECRET,(e,r)=>{if(e)throw Error(e.message);return r});if(r.exp<Math.floor(Date.now()/1e3))throw Error("Token expired");return r}catch(e){throw Error(e.message)}}},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[922,205,663,629],()=>t(7187));module.exports=o})();