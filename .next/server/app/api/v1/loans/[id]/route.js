"use strict";(()=>{var e={};e.id=129,e.ids=[129],e.modules={846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1421:e=>{e.exports=require("node:child_process")},1455:e=>{e.exports=require("node:fs/promises")},1708:e=>{e.exports=require("node:process")},2659:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>E,routeModule:()=>y,serverHooks:()=>x,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var a={};t.r(a),t.d(a,{DELETE:()=>h,GET:()=>c,PATCH:()=>w});var o=t(6559),s=t(8088),n=t(7719);t(6275);let{NextResponse:i}=t(2190),{validateToken:u}=t(8682),{getLoanById:d,deleteLoans:p,updateLoans:l}=t(5446),c=async(e,{params:r})=>{try{let t=e.headers.get("Authorization");await u(t.split(" ")[1]);let{id:a}=await r;if(!(a=parseInt(a)))throw Error("Invalid id");let o=await d(a);return i.json({message:"successfully loan by id",data:o},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return i.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},h=async(e,{params:r})=>{try{let t=e.headers.get("Authorization"),{id:a}=await r;if(!(a=parseInt(a)))throw Error("Invalid id");await u(t.split(" ")[1]);let o=await p(a);return i.json({message:"delete loans successfully",result:o},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return i.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},w=async(e,{params:r})=>{try{let t=e.headers.get("Authorization"),{id:a}=await r,o=await e.json();if(!(a=parseInt(a)))throw Error("Invalid id");o.id=a,console.log("dataJson",o),await u(t.split(" ")[1]);let s=await l(o);return i.json({message:"update loans successfully",result:s},{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return i.json({message:e.message},{status:400,headers:{"Content-Type":"application/json"}})}},y=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/v1/loans/[id]/route",pathname:"/api/v1/loans/[id]",filename:"route",bundlePath:"app/api/v1/loans/[id]/route"},resolvedPagePath:"/home/zaens/Codes/rest-api-with-nextjs/app/api/v1/loans/[id]/route.js",nextConfigOutput:"",userland:a}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:x}=y;function E(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},3024:e=>{e.exports=require("node:fs")},3033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3873:e=>{e.exports=require("path")},4870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5446:(e,r,t)=>{t.r(r),t.d(r,{createLoan:()=>o,deleteLoans:()=>u,getAllLoans:()=>n,getLoanById:()=>s,updateLoans:()=>i});var a=t(1937);let o=async e=>{let{book_id:r,user_id:t}=e;try{if(!t)throw Error("Missing required field: user_id");if(!r)throw Error("Missing required field: book_id)");let e=Math.floor(Date.now()/1e3)+259200,o=new Date(1e3*e);return await a.A.loan.create({data:{book_id:r,user_id:t,due_date:o}})}catch(e){throw Error("Error creating loan")}},s=async e=>{try{let r=await a.A.loan.findUnique({where:{id:e}});if(!r)throw Error("Loan not found");return r}catch(e){throw Error(e.message)}},n=async()=>{try{return await a.A.loan.findMany()}catch(e){throw Error("Error fetching loans")}},i=async e=>{try{let{id:r,...t}=e;if(!r)throw Error("Loan ID is required.");let o=new Date,s={};if(0===Object.keys(t).length)throw Error("No fields provided for PATCH.");return(s=t).return_date=o,s.status="returned",console.log({updates:s}),await a.A.loan.update({where:{id:r},data:s})}catch(r){if("P2025"===r.code)throw Error(`Loans with id ${e.id} not found.`);throw r}},u=async e=>{try{return await a.A.loan.delete({where:{id:e}})}catch(e){throw Error("Loan not found")}}},5511:e=>{e.exports=require("crypto")},6275:(e,r,t)=>{t.r(r),t.d(r,{createUser:()=>s,getUserByEmail:()=>i,getUserById:()=>n,getUserByUsername:()=>u});var a=t(1937),o=t(5663);let s=async e=>{try{let{email:r,password:t,username:s,fullname:n}=e;if(await a.A.user.findUnique({where:{username:s}}))throw Error("User already exists");if(await a.A.user.findUnique({where:{email:r}}))throw Error("Email already exists");let i=await (0,o.tW)(t,10);return await a.A.user.create({data:{email:r,password:i,username:s,fullname:n??void 0}})}catch(e){throw console.error("Error creating user:",e),Error(e.message)}},n=async e=>{try{let r=await a.A.user.findUnique({where:{id:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}},i=async e=>{try{let r=await a.A.user.findUnique({where:{email:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}},u=async e=>{try{let r=await a.A.user.findUnique({where:{username:e}});if(!r)throw Error("User not found");return r}catch(e){throw Error(e.message)}}},6698:e=>{e.exports=require("node:async_hooks")},6760:e=>{e.exports=require("node:path")},7066:e=>{e.exports=require("node:tty")},7598:e=>{e.exports=require("node:crypto")},7910:e=>{e.exports=require("stream")},7975:e=>{e.exports=require("node:util")},8161:e=>{e.exports=require("node:os")},8354:e=>{e.exports=require("util")},8474:e=>{e.exports=require("node:events")},8682:(e,r,t)=>{t.r(r),t.d(r,{validateToken:()=>s});var a=t(5586),o=t.n(a);let s=e=>{try{if(!e)throw Error("Token is required");let r=o().verify(e,process.env.JWT_SECRET,(e,r)=>{if(e)throw Error(e.message);return r});if(r.exp<Math.floor(Date.now()/1e3))throw Error("Token expired");return r}catch(e){throw Error(e.message)}}},9021:e=>{e.exports=require("fs")},9294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{e.exports=require("buffer")}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[922,205,663,629],()=>t(2659));module.exports=a})();